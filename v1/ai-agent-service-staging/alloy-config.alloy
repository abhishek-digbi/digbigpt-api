logging {
  level = "info"
  format = "json"
}
otelcol.receiver.otlp "default" {
  http { endpoint = "0.0.0.0:4318" }
  grpc { endpoint = "0.0.0.0:4317" }

  output {
    metrics = [otelcol.processor.batch.default.input]
  }
}

otelcol.processor.batch "default" {
  send_batch_size    = 100
  timeout            = "1m"
  send_batch_max_size = 200
  
  output {
    metrics = [otelcol.exporter.prometheus.to_prom.input]
  }
}

otelcol.exporter.prometheus "to_prom" {
  forward_to = [prometheus.remote_write.grafana.receiver]
}

prometheus.remote_write "grafana" {
  endpoint {
    url = env("GRAFANA_REMOTE_WRITE_URL")

    basic_auth {
      username = env("GRAFANA_REMOTE_WRITE_USERNAME")
      password = env("GRAFANA_REMOTE_WRITE_PASSWORD")
    }
  }

}

